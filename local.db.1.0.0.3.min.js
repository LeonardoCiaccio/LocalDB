!function(){"use strict";var r="-",e={storage:localStorage,name:"MyDB",onerror:function(){},change:function(){},encrypt:function(r){return r},decrypt:function(r){return r}},t={isUnique:function(r,e){return!e.unique||""==e.unique||r.every(function(r){return!r.unique||r.unique!=e.unique})},setDBtable:function(t,n){var o=e.storage,i=e.name,a=e.encrypt;n=n||[];var u=i+r+t;try{var f=a(JSON.stringify(n))||JSON.stringify(n);return o[u]=f,!0}catch(c){return!1}},getDBtable:function(t){var n=e.storage,o=e.name,i=e.decrypt,a=o+r+t;if("undefined"==typeof n[a])return[];try{var u=i(n[a])||n[a];return JSON.parse(u)}catch(f){try{return JSON.parse(n[a])}catch(f){return null}}},deepMerge:function(r,e){var t;for(t in e)"object"!=typeof r[t]?r[t]=e[t]:"object"==typeof e[t]&&(r[t]=this.deepMerge(r[t],e[t]));return r}},n=function(r){if("object"==typeof r&&t.deepMerge(e,r),e.storage=r.storage!=localStorage&&r.storage!=sessionStorage?localStorage:r.storage,"string"!=typeof e.name||""==e.name)throw new Error("Name of db is required !");if("function"!=typeof e.onerror)throw new Error("Onerror need function !");if("function"!=typeof e.change)throw new Error("Change need function !");if("function"!=typeof e.encrypt)throw new Error("Encrypt need function !");if("function"!=typeof e.decrypt)throw new Error("Decrypt need function !");return this};n.prototype.add=function(r,n,o){if(!r)throw new Error("localdb.prototype.add : Table name required !");n=Array.isArray(n)?n:[n],"function"!=typeof o&&(o=function(){});var i=t.getDBtable(r);if(!i)return e.onerror(100)||!1;for(var a=0,u=[],f=0;f<n.length;f++){var c=n[f];if(t.isUnique(i,c)){var p=t.deepMerge(c,{"#":this.getNextID(r)});i.push(p),u.push(p)}else a=1}var s=t.setDBtable(r,i);return s?(o(a,u),e.change(r,u,"add",i),this):e.onerror(101)||!1},n.prototype.update=function(r,n,o){if(!r)throw new Error("localdb.prototype.update : Table name required !");n=Array.isArray(n)?n:[n],"function"!=typeof o&&(o=function(){});var i=t.getDBtable(r);if(!i)return e.onerror(100)||!1;for(var a=[],u=0,f=0;f<i.length&&u<n.length;f++)for(var c=0;c<n.length;c++){var p=n[c];if(i[f]["#"]==p["#"]){u++;var s=i.slice();if(s.splice(f,1),!t.isUnique(s,p))continue;i[f]=t.deepMerge(i[f],p),a.push(i[f])}}var l=t.setDBtable(r,i);return l?(o(a.length==n.length?0:2,a),e.change(r,a,"update",i),this):e.onerror(101)||!1},n.prototype.remove=function(r,n,o){if(!r)throw new Error("localdb.prototype.remove : Table name required !");n=Array.isArray(n)?n:[n],"function"!=typeof o&&(o=function(){});var i=t.getDBtable(r);if(!i)return e.onerror(100)||!1;for(var a=[],u=0;u<n.length;u++){var f=i.findIndex(function(r){return r["#"]==n[u]});a.push(i[f]),i.splice(f,1)}var c=t.setDBtable(r,i);return c?(o(a.length==n.length?0:3,a),e.change(r,a,"remove",i),this):e.onerror(101)||!1},n.prototype.move=function(r,n,o,i){if(!r)throw new Error("localdb.prototype.move : Table name required !");if(!(n>-1&&o>-1))throw new Error("localdb.prototype.move : ID required !");"function"!=typeof i&&(i=function(){});var a=t.getDBtable(r);if(!a)return e.onerror(100)||!1;var u=a.findIndex(function(r){return o==r["#"]});if(0>u)return i(4,null),!1;var f=a.findIndex(function(r){return n==r["#"]});if(0>f)return i(5,null),!1;if(f==u)return i(6,null),!1;var c=a.splice(f,1);a.splice(u,0,c[0]);var p=t.setDBtable(r,a);return p?(i(0,c),e.change(r,c,"move",a),this):e.onerror(101)||!1},n.prototype.invert=function(r,n,o,i){if(!r)throw new Error("localdb.prototype.invert : Table name required !");if(!(n>-1&&o>-1))throw new Error("localdb.prototype.invert : ID required !");"function"!=typeof i&&(i=function(){});var a=t.getDBtable(r);if(!a)return e.onerror(100)||!1;var u=a.findIndex(function(r){return o==r["#"]});if(0>u)return i(4,null),!1;var f=a.findIndex(function(r){return n==r["#"]});if(0>f)return i(5,null),!1;if(f==u)return i(6,null),!1;var c,p;f>u?(c=a.splice(f,1),p=a.splice(u,1),a.splice(u,0,c[0]),a.splice(f,0,p[0])):(p=a.splice(u,1),c=a.splice(f,1),a.splice(f,0,p[0]),a.splice(u,0,c[0]));var s=t.setDBtable(r,a);return s?(i(0,[c,p]),e.change(r,[c,p],"invert",a),this):e.onerror(101)||!1},n.prototype.query=function(r,n,o){if(!r)throw new Error("localdb.prototype.query : Table name required !");"function"!=typeof n&&(n=function(){return!0}),o||(o={}),o.offset=o.offset&&parseInt(o.offset)>0?parseInt(o.offset):0,o.limit=o.limit&&parseInt(o.limit)>0?parseInt(o.limit):-1,"disc"!==o.sort&&(o.sort="asc"),o.sensitive=o.sensitive||!1;var i=[],a=t.getDBtable(r);if(!a)return e.onerror(100)||[];a.slice();o.sortby&&"string"==typeof o.sortby&&a.sort("asc"==o.sort?function(r,e){return"string"==typeof r[o.sortby]&&"string"==typeof e[o.sortby]?r[o.sortby].localeCompare(e[o.sortby]):parseInt(r[o.sortby])-parseInt(e[o.sortby])}:function(r,e){return"string"==typeof r[o.sortby]&&"string"==typeof e[o.sortby]?e[o.sortby].localeCompare(r[o.sortby]):parseInt(e[o.sortby])-parseInt(r[o.sortby])});for(var u=o.offset;u<a.length&&(o.limit<0||u<o.limit);u++){var f=a[u];n(f)===!0&&i.push(f)}return i},n.prototype.encryptdb=function(r){var t=e.storage,n={};for(var o in t)if(o.match(new RegExp("^"+e.name,"g")))try{var i=e.encrypt(t[o],r);if(!i)return!1;n[o]=i}catch(a){return!1}for(var o in n)t[o]=n[o];return!0},n.prototype.decryptdb=function(r){var t=e.storage,n={};for(var o in t)if(o.match(new RegExp("^"+e.name,"g"))){try{if(JSON.parse(t[o])){n[o]=t[o];continue}}catch(i){}try{var a=e.decrypt(t[o],r);if(a){if(JSON.parse(a)){n[o]=a;continue}return!1}return!1}catch(i){return!1}}for(var o in n)t[o]=n[o];return!0},n.prototype.countRecords=function(r){if(!r)throw new Error("localdb.prototype.countRecords : Table name required !");var n=t.getDBtable(r);return n?n.length:e.onerror(100)||!1},n.prototype.getNextID=function(r){if(!r)throw new Error("localdb.prototype.getNextID : Table name required !");var n=t.getDBtable(r);return n?n.length>0?n.sort(function(r,e){return e["#"]-r["#"]})[0]["#"]+1:0:e.onerror(100)||!1},window.localdb=n}();
//# sourceMappingURL=local.db.1.0.0.3.min.js.map